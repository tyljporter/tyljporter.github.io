---
title: "Spotify Recommendation Engine"
date: 2020-11-14
tags: [machine learning, python]
excerpt: "Spotify project using machine learning"
mathjax: "true"
---
## Introduction
As an avid music listener, after the discovery of the [Spotify API](https://developer.spotify.com/documentation/web-api/) and an accompanying [python library](https://spotipy.readthedocs.io/en/2.16.1/#), I was very excited to dig in and start playing with some of my own user data!

In my Spotify library, I have a master playlist of songs that fit into my favorite mash-up of genres: Post-harcore, pop punk, metalcore, and alt-rock; when I come accross new music that fits into the genre, I throw it into that playlist so that I can come back to it later.
<div>
  <iframe src="https://open.spotify.com/embed/playlist/3dgfLqrR0v70pKNb961q6q" width="600" height="420" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
</div>


Spotify makes it easy to 'like' certain songs and places them in a separate, private playlist.
This got me thinking; assuming that all of my 'liked' songs are within the above playlist, can we use Machine Learning to decipher what makes a song go from simply a good song to one that I absolutely love?


## Overview
Tools utilized:
* Python
* Orange
* Spotify API


Python libraries used:
* [Spotipy](https://spotipy.readthedocs.io/en/2.16.1/#)
* [Pandas](https://pandas.pydata.org/docs/)
* [Sys](https://docs.python.org/3/library/sys.html)
* [Math](https://docs.python.org/3/library/math.html)


## Methodology

In order to get connected to the Spotify API, an app must be made within Spotify developer. This was easily done by following the instructions found in [Spotify's documentation](https://developer.spotify.com/documentation/web-api/quick-start/).

Once the application was created, a client ID and secret was generated. An easy to remember redirect URI was set.
(Note: These have been removed from the below code for security reasons)

In Python, these are set as local variables that are then passed to Spotipy's `prompt_for_user_token()` function that generates an authorization token that is then passed to authorization. This is also where the scope is set; for this project, all we will need is read only access to the user library. If the current user is not authorized, the code will prompt the user to login to Spotify, then paste the URL that the browser was redirected to.

```python
#Get token and authorize. Will prompt user to enter
#redirect URI on first run
username = ~~REDACTED~~
client_id = ~~REDACTED~~
client_secret = ~~REDACTED~~
redirect_uri = 'https://google.com/'
scope = 'user-library-read'

token = util.prompt_for_user_token(username=username,
                                   scope=scope,
                                   client_id=client_id,   
                                   client_secret=client_secret,     
                                   redirect_uri=redirect_uri)
sp = spotipy.Spotify(auth=token)
```


Now we are authorized and ready to start pulling some data!
The first step is to utilize Spotipy's `current_user_saved_tracks()` to pull my library of saved tracks.
A custom function was created to return *all* saved tracks; Note: Spotipy returns paginated results with a 20 item limit. To learn more, click [here](https://spotipy.readthedocs.io/en/2.16.1/#spotipy.client.Spotify.current_user_saved_tracks).
```python
#Define function to pull saved tracks
def get_faves():
    results = sp.current_user_saved_tracks()
    tracks = results['items']
    while results['next']:
        results = sp.next(results)
        tracks.extend(results['items'])
    return tracks
```
